<div class="page-content">
  <div class="container-fluid">
    <h2>Classes</h2>
    <hr />
    <div class="row gutters-sm">
      <div class="col-md-12 py-3">
        <div class="row justify-content-end">
          <select id="year" class="col-2 form-control mb-4 mr-3">
            <option value="2021" selected>2021</option>
            <option value="2020">2020</option>
            <option value="2019">2019</option>
          </select>
          <input
            class="col-3 form-control mb-4 mr-3"
            id="query"
            type="text"
            placeholder="Search here"
          />
        </div>
        <div class="card p-0">
          <table class="table table-striped">
            <thead>
              <tr>
                <th scope="col">#</th>
                <th scope="col">Class Name</th>
                <th scope="col">Academic Year</th>
                <th scope="col">Action</th>
              </tr>
            </thead>
            <tbody id="table"></tbody>
          </table>
        </div>
      </div>
    </div>
    <hr />
    <footer class="text-center">
      <div class="mb-2">
        <small>
          Â© 2021 made by -
          <a
            target="_blank"
            rel="noopener noreferrer"
            href="https://www.ive.edu.hk/ivesite/html/tc/"
          >
            Ive Jai
          </a>
        </small>
      </div>
    </footer>
  </div>
</div>

<script>
  $(document).ready(function () {
    var year = $("#year option:selected").val();
    loadData(year);
    $("#year").change(function () {
      year = $("#year option:selected").val();
      loadData(year);
    });

    $("#query").on("keyup", function () {
      var value = $(this).val().toLowerCase();
      $("#table tr").filter(function () {
        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
      });
    });
    function loadData(year) {
      $("#table").empty();
      $.ajax(`http://127.0.0.1/itp4506/Attendance-Online-Server/admin/viewClass.php`,{
          method: 'post',
          data: {
            year: year,
          },
          dataType: "json",
          timeout: 500,
          success: function (data, status, xhr) {
            var result = "";
            $(data).each(function (index) {
              result += `
              <tr>
            <th scope="row">${index + 1}</th>
            <td>${this.name}</td>
            <td>${this.academicYear}</td>
            <td><a class="btn btn-secondary" href="http://127.0.0.1/itp4506/Attendance-Online-Web/admin/class-detail.html?classId=${this.id}">Details</a></td>
            </tr>
              `;
            });
            $("#table").append(result);
          },
          error: function (jqXhr, textStatus, errorMessage) {
            $("body").append("Error: " + errorMessage);
          },
        });
    }
  });
</script>
