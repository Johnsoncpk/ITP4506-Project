<div class="page-content">
    <div class="container-fluid">
        <h2 id="header">Attendance Record</h2>
        <hr />
        <div class="row gutters-sm">
            <div class="col-md-12 py-3">
                <div class="col-md-12 pb-3">
                    <div class="row justify-content-end">
                        <div class="dropdown">
                            <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton1"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Year
                            </button>
                            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                <a class="dropdown-item item1" href="#">2021</a>
                                <a class="dropdown-item item1" href="#">2020</a>
                            </div>
                        </div>
                        <div class="dropdown ml-2">
                            <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton2"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Month
                            </button>
                            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                <a class="dropdown-item item2" href="#">01</a>
                                <a class="dropdown-item item2" href="#">02</a>
                                <a class="dropdown-item item2" href="#">03</a>
                                <a class="dropdown-item item2" href="#">04</a>
                                <a class="dropdown-item item2" href="#">05</a>
                                <a class="dropdown-item item2" href="#">06</a>
                                <a class="dropdown-item item2" href="#">07</a>
                                <a class="dropdown-item item2" href="#">08</a>
                                <a class="dropdown-item item2" href="#">09</a>
                                <a class="dropdown-item item2" href="#">10</a>
                                <a class="dropdown-item item2" href="#">11</a>
                                <a class="dropdown-item item2" href="#">12</a>
                            </div>
                        </div>
                        <a class="btn btn-info mx-2 edit" id="report" href="./report.html?type=student&studentId=` +studentIdReceived +`">Get Student Report</a>
                    </div>
                </div>
                <div class="card p-0">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th scope="col">Date</th>
                                <th scope="col">Time</th>
                                <th scope="col">Status</th>
                            </tr>
                        </thead>
                        <tbody id="attendDetail"></tbody>
                    </table>
                </div>
            </div>
        </div>
        <hr />
        <footer class="text-center">
            <div class="mb-2">
                <small>
                    Â© 2021 made by -
                    <a target="_blank" rel="noopener noreferrer" href="https://www.ive.edu.hk/ivesite/html/tc/">
                        Ive Jai
                    </a>
                </small>
            </div>
        </footer>
    </div>
</div>

<script>
    $(document).ready(function () {

        let searchParams = new URLSearchParams(window.location.search)
        //alert(searchParams.get('type'));
        var studentId = searchParams.get('studentId');
        $('#header').text("Attendance Record - "+studentId);
        $("#report").attr('href', './report.html?type=student&studentId=' + studentId);
        $.ajax({
            type: "post",
            url: `http://127.0.0.1/itp4506/Attendance-Online-Server/genReport/searchAttendance.php`,
            data: {
                id: studentId,
            },
            success: function (data, status, xhr) {
                console.log(data);
                var result = "";
                $(data).each(function (index) {
                    $statusShow = this.status;
                    if ($statusShow == "earlyLeave") {
                        $statusShow = "early leave";
                    } else if ($statusShow == "earlyLeave") {
                        $statusShow = "early leave";
                    } else if ($statusShow == "sickLeave") {
                        $statusShow = "sick leave";
                    } else if ($statusShow == "personalLeave") {
                        $statusShow = "personal leave";
                    } else if ($statusShow == "absent") {
                        $statusShow = "absent without reason";
                    }
                    result += `
                        <tr class="record">
                        <td>${this.date}</td>
                        <td>${this.time}</td>
                        <td>`+ $statusShow + `</td>
                        </tr>
                        `;
                });
                $("#attendDetail").append(result);
            },
            error: function (jqXhr, textStatus, errorMessage) {
            }
        });

        $(".item1").click(function () {
            $("#dropdownMenuButton1").text($(this).text());
            $(".record").hide();
            if ($("#dropdownMenuButton2").text().trim() === "Month") {
                $(".record").filter(":contains(" + $("#dropdownMenuButton1").text() + ")").show();
            } else{
                $(".record").filter(":contains(" + $("#dropdownMenuButton1").text() + "-" + $("#dropdownMenuButton2").text() + ")").show();
            }
        });


        $(".item2").click(function () {
            $("#dropdownMenuButton2").text($(this).text());
            $(".record").hide();
            if ($("#dropdownMenuButton1").text().trim() === "Year") {
                $(".record").filter(":contains('-" + $("#dropdownMenuButton2").text() + "-')").show();
            } else{
                $(".record").filter(":contains(" + $("#dropdownMenuButton1").text() + "-" + $("#dropdownMenuButton2").text() + ")").show();
            }
        });

        $("#query").on("keyup", function () {
            var value = $(this).val().toLowerCase();
            $("#table tr").filter(function () {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
            });
        });
    });
</script>